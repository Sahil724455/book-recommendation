{% extends "base.html" %}
{% block title %}{{ book.title }}{% endblock %}

{% block content %}
<div style="margin-bottom:1rem;">
    <a href="/books" style="color:var(--primary-light); text-decoration:none; font-size:0.9rem;">
        <i class="fas fa-arrow-left"></i> Back to Books
    </a>
</div>

<div class="card" style="margin-bottom:2rem; padding:2rem;">
    <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:1rem; flex-wrap:wrap; gap:0.5rem;">
        <span class="badge badge-secondary" style="font-size:0.85rem;">{{ book.genre }}</span>
        <span style="color:var(--text-muted);">Published: {{ book.year }}</span>
    </div>

    <h1 style="font-size:1.8rem; font-weight:800; margin-bottom:0.5rem;">{{ book.title }}</h1>
    <p style="color:var(--primary-light); font-size:1.1rem; margin-bottom:1rem;">by {{ book.author }}</p>

    <div style="display:flex; gap:2rem; margin-bottom:1.5rem; flex-wrap:wrap;">
        <div>
            <span style="font-size:0.75rem; color:var(--text-muted); text-transform:uppercase;">Average Rating</span><br>
            <span class="stars" style="font-size:1.2rem;">
                {% for i in range(avg_rating|int if avg_rating != 'N/A' else 0) %}<i class="fas fa-star"></i>{% endfor %}
            </span>
            <span style="font-weight:700; font-size:1.2rem; margin-left:0.3rem;">{{ avg_rating }}</span>
        </div>
        <div>
            <span style="font-size:0.75rem; color:var(--text-muted); text-transform:uppercase;">Total Ratings</span><br>
            <span style="font-weight:700; font-size:1.2rem;">{{ num_ratings }}</span>
        </div>
    </div>

    <p style="font-size:1rem; line-height:1.8; color:var(--text-muted);">{{ book.description }}</p>
</div>

<!-- Similar Books -->
{% if similar_books %}
<h2 style="font-size:1.3rem; font-weight:700; margin-bottom:1.5rem;">
    <i class="fas fa-magic" style="color:var(--accent);"></i> Similar Books
    <span style="font-size:0.8rem; color:var(--text-muted); font-weight:400;">(Content-Based Filtering)</span>
</h2>

<div class="grid-3">
    {% for sb in similar_books %}
    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:0.5rem;">
            <span class="badge badge-secondary">{{ sb.genre }}</span>
            <span style="color:var(--text-muted); font-size:0.8rem;">{{ sb.year }}</span>
        </div>
        <h3 class="card-title" style="font-size:1rem;">
            <a href="/book/{{ sb.book_id }}" style="color:var(--text); text-decoration:none;">{{ sb.title }}</a>
        </h3>
        <p style="color:var(--primary-light); font-size:0.85rem; margin-bottom:0.5rem;">{{ sb.author }}</p>
        <div style="margin-top:0.75rem;">
            <span style="font-size:0.75rem; color:var(--text-muted);">Similarity Score:</span>
            <div style="background:var(--bg); border-radius:4px; height:8px; margin-top:0.3rem; overflow:hidden;">
                <div style="background:linear-gradient(90deg, var(--primary), var(--secondary)); height:100%; width:{{ (sb.similarity_score * 100)|int }}%; border-radius:4px;"></div>
            </div>
            <span style="font-size:0.8rem; font-weight:600;">{{ "%.1f"|format(sb.similarity_score * 100) }}%</span>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}
