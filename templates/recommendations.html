{% extends "base.html" %}
{% block title %}Recommendations for User {{ user_id }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-lightbulb" style="-webkit-text-fill-color:#FBBF24;background:none;"></i> Recommendations for User {{ user_id }}</h1>
    <p>Algorithm: <strong>{{ algo_name }}</strong></p>
</div>

<!-- User's Reading History -->
<div class="card" style="margin-bottom:2rem;">
    <h3 style="margin-bottom:1rem;">
        <i class="fas fa-history" style="color:var(--primary-light)"></i>
        User {{ user_id }}'s Rating History
        <span class="badge badge-primary" style="margin-left:0.5rem;">{{ user_ratings|length }} books rated</span>
    </h3>
    <div style="overflow-x:auto;">
        <table>
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Genre</th>
                    <th>Rating</th>
                </tr>
            </thead>
            <tbody>
                {% for r in user_ratings[:10] %}
                <tr>
                    <td><a href="/book/{{ r.book_id }}" style="color:var(--primary-light); text-decoration:none;">{{ r.title }}</a></td>
                    <td>{{ r.author }}</td>
                    <td><span class="badge badge-secondary">{{ r.genre }}</span></td>
                    <td>
                        <span class="stars">
                            {% for i in range(r.rating|int) %}<i class="fas fa-star"></i>{% endfor %}
                            {% if r.rating % 1 >= 0.5 %}<i class="fas fa-star-half-alt"></i>{% endif %}
                        </span>
                        <span style="color:var(--text-muted); margin-left:0.3rem;">{{ r.rating }}</span>
                    </td>
                </tr>
                {% endfor %}
                {% if user_ratings|length > 10 %}
                <tr><td colspan="4" style="text-align:center; color:var(--text-muted);">... and {{ user_ratings|length - 10 }} more ratings</td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Recommendations -->
<h2 style="font-size:1.3rem; font-weight:700; margin-bottom:1.5rem;">
    <i class="fas fa-star" style="color:#FBBF24;"></i>
    Top {{ n }} Recommended Books
</h2>

{% if recommendations %}
<div class="grid-2">
    {% for rec in recommendations %}
    <div class="card" style="display:flex; flex-direction:column; justify-content:space-between;">
        <div>
            <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:0.5rem;">
                <span class="badge badge-accent" style="font-size:0.8rem;">#{{ loop.index }}</span>
                <span class="badge badge-secondary">{{ rec.genre }}</span>
            </div>
            <h3 class="card-title" style="font-size:1.05rem;">
                <a href="/book/{{ rec.book_id }}" style="color:var(--text); text-decoration:none;">{{ rec.title }}</a>
            </h3>
            <p style="color:var(--text-muted); font-size:0.85rem; margin-bottom:0.5rem;">
                by {{ rec.author }} &bull; {{ rec.year }}
            </p>
            <p style="font-size:0.85rem; color:var(--text-muted); line-height:1.5;">
                {{ rec.description[:150] }}{% if rec.description|length > 150 %}...{% endif %}
            </p>
        </div>
        <div style="margin-top:1rem; display:flex; justify-content:space-between; align-items:center;">
            <div>
                <span style="font-size:0.75rem; color:var(--text-muted); text-transform:uppercase;">Predicted Rating</span><br>
                <span class="stars" style="font-size:1.1rem;">
                    {% for i in range(rec.predicted_rating|int) %}<i class="fas fa-star"></i>{% endfor %}
                    {% if rec.predicted_rating % 1 >= 0.25 %}<i class="fas fa-star-half-alt"></i>{% endif %}
                </span>
                <span style="font-weight:700; margin-left:0.3rem;">{{ "%.1f"|format(rec.predicted_rating) }}</span>
            </div>
            <a href="/book/{{ rec.book_id }}" class="btn btn-outline" style="font-size:0.8rem; padding:0.4rem 0.8rem;">
                Details <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card" style="text-align:center; padding:3rem;">
    <i class="fas fa-search" style="font-size:2.5rem; color:var(--text-muted); margin-bottom:1rem;"></i>
    <h3>No Recommendations Found</h3>
    <p style="color:var(--text-muted);">This user may have rated all available books, or there isn't enough data.</p>
</div>
{% endif %}

<!-- Try another -->
<div style="text-align:center; margin-top:2rem;">
    <a href="/" class="btn btn-primary btn-lg">
        <i class="fas fa-redo"></i> Try Another User / Algorithm
    </a>
    <a href="/compare" class="btn btn-accent btn-lg" style="margin-left:0.5rem;">
        <i class="fas fa-chart-bar"></i> Compare Algorithms
    </a>
</div>
{% endblock %}
